<!DOCTYPE html>
<html>
	<head>
		<link rel='stylesheet' href='/index.css'>
	</head>
	<body>
		<div class='card'> 
			<h1>Admin Dashboard</h1>
		</div>

		<div class='card'>
			<div class='linear'>
				<h2>Modules</h2>
				<button id="reload">Reload</button>
			</div>

			<div class="fg">
				<h3>Loaded Modules</h3>
				<div id='loadedModules'></div><br>
			</div>

			<form class='fg'>
				<h3>Add Uploaded Module</h3>
				<select id="unloadedModules">
				</select>
				<button id="addModule">Add Module</button>
			</form>
			<br>
			
			<form class='fg'>
				<h3>Upload New Module</h3>
				<input type='file' name='moduleFile' required>
				<button>Upload Module</button>
			</form>
		</div>

		<div class='card'>
			<h2>Module Configs</h2>
			<br>
			<form id='moduleConfig'>
			</form>
		</div>

		<div class="card">
			<h2>Statistics</h2>
			<div class="fg">
				<p id="totalQueries"></p>
			</div>
		
			<div class="chartGrid">			
				<div class="chart pie"><canvas id="cumulativeModuleRequestsChart" class="chart"></canvas></div>
				<div class="chart"><canvas id="dailyTotalRequestsChart" class="chart"></canvas></div>
			</div>
			
		</div>

		<div class="card">
			<h2>API</h2>
			<button id="resetApiKey">Reset API Key</button>
		</div>

		<div class="modal" id="newApiKeyModal" style="height:100px; width: 65vw; visibility: hidden;">
			<h3>New API Key</h3>
			<p class="fg" style="margin:5px; overflow-x: scroll;" id="apiKey"></p>
			<button id="close" style="margin:0px">Done</button>
		</div>

		<script src="/js/pageLoader.js"></script>
		<script type="module" src="/js/statsLoader.js"></script>

		<script>
			const closeButton = document.getElementById("close");
			const modal = document.getElementById("newApiKeyModal");
			closeButton.addEventListener('click', (e) => {
				modal.style.visibility = 'hidden';
			});

			const resetApiKeyButton = document.getElementById('resetApiKey');
			const apiKey = document.getElementById('apiKey');
			resetApiKeyButton.addEventListener('click', async (e) => {
				await fetch('/resetApiKey')
					.then(data => {return data.text();})
					.then(newKey => {
						apiKey.innerText = newKey;
						modal.style.visibility = 'visible';
						console.log(newKey);
					});
			});
		</script>
	</body>
</html>