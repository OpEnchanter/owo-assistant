<!DOCTYPE html>
<html>
	<head>
		<link rel='stylesheet' href='/index.css'>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>
		<div class="notification">Configs Updated!</div>

		<div class='card title'> 
			<h1>Admin Dashboard</h1>
		</div>

		<div class='card'>
			<div class='linear'>
				<h2>Modules</h2>
			</div>

			<div class="fg">
				<h3>Loaded Modules</h3>
				<div id='loadedModules'></div><br>
			</div>

			<form class='fg'>
				<h3>Add Uploaded Module</h3>
				<select id="unloadedModules">
				</select>
				<button id="addModule">Add Module</button>
			</form>
			<br>
			
			<form class='fg'>
				<h3>Upload New Module</h3>
				<input type='file' name='moduleFile' required>
				<button>Upload Module</button>
			</form>
		</div>

		<div class='card'>
			<h2>Module Configs</h2>
			<br>
			<form id='moduleConfig'></form>
		</div>

		<div class="card">
			<h2 class="linear">Statistics
				<div class="info">i
					<div class="popover">Usage statistics for the app. none of this data is ever shared with a third party.</div>
				</div>
			</h2>
			<div class="fg">
				<p id="totalQueries"></p>
			</div>
		
			<div class="chartGrid">			
				<div class="chart pie"><canvas id="cumulativeModuleRequestsChart" class="chart"></canvas></div>
				<div class="chart"><cNew anvas id="dailyTotalRequestsChart" class="chart"></canvas></div>
			</div>
			
		</div>

		<div class="card">
			<h2>API</h2>
			<div class="fg danger">
				<h3>DANGER ZONE</h3>
				<button id="resetApiKey">Rotate API Key</button>
			</div>
		</div>

		<div class="modal" id="newApiKeyModal" style="visibility: hidden;">
			<h3>New API Key</h3>
			<div class="apiKeyContainer">
				<p class="fg" id="apiKey"></p>
				<button onclick="copyApiKey()" id="copyApiKey">ðŸ“‹</button>
			</div>
			<button id="close" style="margin:0px">Done</button>
		</div>

		<script src="/js/pageLoader.js"></script>
		<script type="module" src="/js/statsLoader.js"></script>

		<script>

			function copyApiKey() {
				navigator.clipboard.writeText(key);

				notificationPopup.style.top = "15px";
				notificationPopup.style.background = "var(--success)";
                notificationPopup.innerText = "API key copied!"

                setTimeout(() => {
                    notificationPopup.style.top = "-150px";
                }, 1500);
			}

			const closeButton = document.getElementById("close");
			const modal = document.getElementById("newApiKeyModal");
			closeButton.addEventListener('click', (e) => {
				modal.style.visibility = 'hidden';
				key = '';
				apiKey.innerHTML = '';
			});

			let key = '';

			const resetApiKeyButton = document.getElementById('resetApiKey');
			const apiKey = document.getElementById('apiKey');
			resetApiKeyButton.addEventListener('click', async (e) => {
				await fetch('/resetApiKey')
					.then(data => {return data.text();})
					.then(newKey => {
						apiKey.innerText = newKey;
						key = newKey;
						modal.style.visibility = 'visible';
						console.log(newKey);
					});
			});
		</script>
	</body>
</html>